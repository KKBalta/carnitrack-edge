# ═══════════════════════════════════════════════════════════════════════════════
# CarniTrack Edge Service - Environment Configuration
# ═══════════════════════════════════════════════════════════════════════════
# Copy this file to .env and configure for your deployment
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# Edge Identity (for Cloud registration)
# ─────────────────────────────────────────────────────────────────────────────
# These are used for initial registration with Cloud
# After registration, edgeId and siteId are stored in the database
EDGE_NAME=Main Facility
SITE_ID=site-001
REGISTRATION_TOKEN=

# ─────────────────────────────────────────────────────────────────────────────
# Cloud Connection
# ─────────────────────────────────────────────────────────────────────────────
# Cloud REST API endpoint (Edge service connects here)
CLOUD_API_URL=https://api.carnitrack.com/api/v1/edge

# ─────────────────────────────────────────────────────────────────────────────
# Server Configuration
# ─────────────────────────────────────────────────────────────────────────────
# TCP Server - DP-401 scales connect here
TCP_PORT=8899
TCP_HOST=0.0.0.0

# HTTP Server - Admin dashboard and API
HTTP_PORT=3000
HTTP_HOST=0.0.0.0

# ─────────────────────────────────────────────────────────────────────────────
# Database Configuration
# ─────────────────────────────────────────────────────────────────────────────
# SQLite database path (use absolute path in Docker)
DB_PATH=/app/data/carnitrack.db

# ─────────────────────────────────────────────────────────────────────────────
# REST API Configuration (Cloud Connection)
# ─────────────────────────────────────────────────────────────────────────────
# Session polling interval (how often to check for active sessions)
SESSION_POLL_INTERVAL_MS=5000

# Event POST timeout
EVENT_SEND_TIMEOUT_MS=10000

# Retry configuration
REST_MAX_RETRIES=3
REST_RETRY_DELAY_MS=1000
REST_BACKOFF_MULTIPLIER=2
REST_MAX_RETRY_DELAY_MS=30000

# Batch configuration
CLOUD_BATCH_SIZE=50
BATCH_INTERVAL_MS=5000

# ─────────────────────────────────────────────────────────────────────────────
# Heartbeat & Health Monitoring
# ─────────────────────────────────────────────────────────────────────────────
# Timeout for device heartbeat (2 missed heartbeats = disconnected)
HEARTBEAT_TIMEOUT_MS=60000

# ─────────────────────────────────────────────────────────────────────────────
# Activity Monitoring
# ─────────────────────────────────────────────────────────────────────────────
# Time without events before marking device as idle
ACTIVITY_IDLE_MS=300000
# Time without events before marking device as stale
ACTIVITY_STALE_MS=1800000

# ─────────────────────────────────────────────────────────────────────────────
# Session Cache Configuration
# ─────────────────────────────────────────────────────────────────────────────
# How long to keep cached sessions valid without Cloud update
SESSION_CACHE_EXPIRY_MS=14400000

# ─────────────────────────────────────────────────────────────────────────────
# Offline Mode Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Time without Cloud connection before entering offline mode
OFFLINE_TRIGGER_DELAY_MS=5000
# Maximum events per offline batch
OFFLINE_MAX_EVENTS_PER_BATCH=1000
# How long to keep offline batches (days)
OFFLINE_BATCH_RETENTION_DAYS=30

# ─────────────────────────────────────────────────────────────────────────────
# PLU Generation
# ─────────────────────────────────────────────────────────────────────────────
PLU_OUTPUT_DIR=/app/generated

# ─────────────────────────────────────────────────────────────────────────────
# Work Hours (for alert thresholds)
# ─────────────────────────────────────────────────────────────────────────────
WORK_HOURS_START=06:00
WORK_HOURS_END=18:00
TIMEZONE=Europe/Istanbul

# ─────────────────────────────────────────────────────────────────────────────
# Logging
# ─────────────────────────────────────────────────────────────────────────────
LOG_LEVEL=info
LOG_DIR=/app/logs
NODE_ENV=production
